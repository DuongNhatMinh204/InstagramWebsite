<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>Trang Chủ - Instagram Clone</title>
    <link rel="stylesheet" href="/css/home.css">
</head>
<body>
<!-- Navigation -->
<nav class="nav-bar">
    <h1>Instagram</h1>
    <div class="nav-items">
        <span>🏠 Home</span>
        <button id="openModalBtn">💬 Messages</button>
        <!-- Modal -->
        <div id="chatModal" class="modal">
            <div class="modal-content">
                <span class="close">×</span>
                <h3>Đoạn chat</h3>
                <input type="text" placeholder="Tìm kiếm trên Messenger..." class="search-box">
                <div class="chat-list" id="chatList">
                    <!-- Dữ liệu người dùng sẽ được render ở đây -->
                </div>
            </div>
        </div>
        <button id="openProfileModal">👤 Profile</button>
    </div>
</nav>
<!-- Modal hiển thị chi tiết đoạn chat với 1 người -->
<div id="chatDetailModal" class="modal chat-detail-modal">
    <div class="modal-content">
        <span class="closeDetail">×</span>
        <h3><span id="chatWithName"></span></h3>
        <div id="chatMessages" style="height: 300px; overflow-y: scroll;"></div>
        <input type="text" id="chatInput" placeholder="Nhập tin nhắn...">
        <button id="sendChatBtn">Gửi</button>
    </div>
</div>
<!-- Profile Modal -->
<div id="profileModal" class="modal">
    <div class="modal-content profile-modal-content">
        <span class="closeProfile">×</span>
        <div class="profile-header">
            <button id="viewProfileBtn">Xem tất cả trang cá nhân</button>
        </div>
        <hr />
        <div class="profile-options">
            <div class="option">⚙️ Cài đặt & quyền riêng tư</div>
            <div class="option">❓ Trợ giúp và hỗ trợ</div>
            <div class="option">🌙 Màn hình & trợ năng</div>
            <div class="option">💬 Đóng góp ý kiến</div>
            <div class="option">🚪 Đăng xuất</div>
        </div>
    </div>
</div>

<div class="main-container">
    <div class="posts-feed">
        <div class="post-card">
            <form id="postForm">
                <div class="post-header">
                    <img id="currentUserAvatar" src="" class="post-avatar" alt="Avatar">
                    <textarea id="content" placeholder="What's on your mind?" style="width:100%; resize: none;"></textarea>
                </div>
                <input type="file" id="imgFile" accept="image/*">
                <button type="submit">Đăng Bài</button>
            </form>
        </div>
        <div id="postsContainer"></div>
    </div>
</div>

<!-- Thêm thư viện sockjs-client và stompjs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script src="/js/home.js"></script>
<script src="/js/chat.js"></script>
<script src="/js/profile.js"></script>
<script>
// Lấy avatar người dùng hiện tại và gán vào phần đăng bài
const token = localStorage.getItem("token");
if (token) {
    fetch("/v1/auth/info", {
        headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(user => {
        document.getElementById("currentUserAvatar").src = user.avatarUrl || "/images/logo.jpg";
    });
}
</script>
</body>
</html>

<style>
.posts-feed {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        .post-card, #postsContainer .post {
            width: 100%;
            max-width: 650px;
        }
        #postsContainer .post {
            margin: 16px auto;
        }
</style>
